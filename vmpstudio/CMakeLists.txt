message(STATUS "Configuring visual icpp...")

project(visualicpp)

# c++
set(CMAKE_CXX_STANDARD 20)
set(CMAKE_CXX_STANDARD_REQUIRED)

# generate debugger protocol data object
add_custom_command(
  OUTPUT icppdbg.pb.cc
  COMMAND ${CMAKE_BINARY_DIR}/third/protobuf/protoc 
    -I=${CMAKE_SOURCE_DIR}/proto --cpp_out=${CMAKE_CURRENT_BINARY_DIR} 
    ${CMAKE_SOURCE_DIR}/proto/icppdbg.proto
  DEPENDS ${CMAKE_SOURCE_DIR}/proto/icppdbg.proto
  VERBATIM)

add_library(visualicpp SHARED
  icppvsp.cpp

  # auto generated by protoc
  icppdbg.pb.cc
)

target_link_libraries(visualicpp PRIVATE
  boost_asio
  libprotobuf
)
  
target_include_directories(visualicpp PRIVATE
  ${CMAKE_BINARY_DIR}/vmpstudio

  boost_asio
  libprotobuf
)

add_dependencies(visualicpp protoc)

message(STATUS "Configuring visual icpp done")
